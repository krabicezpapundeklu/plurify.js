<html>
	<head>
		<script type="text/javascript" src="json2.js"></script>
		<script type="text/javascript" src="plurify.js"></script>

		<style type="text/css">
			table {
				border-collapse: collapse;
			}

			td {
				border: 1px solid black;
				font-family: verdana,tahoma,arial;
				font-size: 12px;
				padding: 3px;
			}

			thead {
				font-weight: bold;
			}

			.fail {
				color: red;
			}

			.success {
				color: green;
			}
		</style>
	</head>
	<body>
		<h1 id="summary"></h1>
		<table>
			<thead>
				<tr><td>Input</td><td>Arguments</td><td>Expected Output</td><td>Output</td></tr>
			</thead>
			<tbody id="results"></tbody>
		</table>

		<script type="text/javascript">
			var tests = [
				{expectedOutput: ""},
				{input: null, arguments: null, expectedOutput: ""},
				{input: "xxx", arguments: null, expectedOutput: "xxx"},
				{input: "x{0}x", arguments: ["y"], expectedOutput: "xyx"},
				{input: "x{0}x{1}x{2}x", arguments: [1, 2, 3], expectedOutput: "x1x2x3x"},
				{input: "{firstName} {lastName}", arguments: {firstName: "John", lastName: "Doe"}, expectedOutput: "John Doe"},
				{input: "x\\{0}x", arguments: null, expectedOutput: "x{0}x"},
				{input: "x\\\\{0}x", arguments: ["y"], expectedOutput: "x\\yx"},
				{input: "x\\\\\\{0}x", arguments: null, expectedOutput: "x\\{0}x"}
			];

			var startDate = new Date();

			for(var i = 0; i < tests.length; ++i) {
				var test = tests[i];
				test.output = plurify(test.input, test.arguments);
			}

			var duration = new Date() - startDate;
			var failed = 0;
			var succeeded = 0;
			var resultHtml = [];

			for(var i = 0; i < tests.length; ++i) {
				var test = tests[i];
				var success = test.expectedOutput == test.output;

				if(success) {
					++succeeded;
				}
				else {
					++failed;
				}

				resultHtml.push("<tr class='" + (success ? "success" : "fail") + "'>");
				resultHtml.push("<td>" + test.input + "</td>");
				resultHtml.push("<td>" + JSON.stringify(test.arguments) + "</td>");
				resultHtml.push("<td>" + test.expectedOutput + "</td>");
				resultHtml.push("<td>" + test.output + "</td>");
				resultHtml.push("</tr>");
			}

			var ieHackNode = document.createElement("div");
			ieHackNode.innerHTML = "<table>" + resultHtml.join("") + "</table>";

			var results = document.getElementById("results");
			results.parentNode.replaceChild(ieHackNode.firstChild.firstChild, results);

			var summary = document.getElementById("summary");
			summary.className = failed > 0 ? "fail" : "success";
			summary.innerHTML = succeeded + " succeeded, " + failed + " failed (in " + duration + "ms)";
		</script>
	</body>
</html>
